<div class="profile-wrapper">

  <div class="background-blobs"></div>

  <div class="profile-card">

    <!-- HEADER -->
    <div class="profile-header">
      <img [src]="user.image" alt="Foto de perfil" id="preview" class="profile-photo" (error)="handleImageError($event)">
      <h2>{{ user.name }}</h2>
      <p class="email">{{ user.email }}</p>
      <p class="role">{{ user.role }}</p>

      <!-- Botones de acciÃ³n principales -->
      <div class="actions">
        <button class="btn secondary" (click)="irAlInicio()">â†©ï¸ Ir a inicio</button>
        <button class="btn" (click)="verMisCursos()" *ngIf="!modoEdicion">ğŸ“š Ver mis cursos</button>
        <button class="btn" (click)="activarEdicion()" *ngIf="!modoEdicion">âœï¸ Editar datos</button>
        <button class="btn success" *ngIf="modoEdicion" (click)="guardarCambios()" [disabled]="!hasChanges || !isValid || saving">ğŸ’¾ Guardar</button>
        <button class="btn warning" *ngIf="modoEdicion" (click)="irACambiarPassword()">ğŸ” Cambiar contraseÃ±a</button>
      </div>

      <p class="avatar-hint" *ngIf="modoEdicion">
        La carga de foto se encuentra deshabilitada temporalmente. Mantendremos tu avatar por defecto.
      </p>
    </div>

    <!-- DATOS PERSONALES EDITABLES -->
    <div class="profile-section card">
      <h3>Datos personales</h3>

      <!-- Vista lectura -->
      <div class="readonly" *ngIf="!modoEdicion">
        <div class="info-item"><label>Nombre</label><span>{{ user.name }}</span></div>
        <div class="info-item"><label>Fecha de nacimiento</label><span>{{ user.birthDate | date:'longDate' }}</span></div>
        <div class="info-item"><label>TelÃ©fono</label><span>{{ user.phone }}</span></div>
        <div class="info-item"><label>GÃ©nero</label><span>{{ user.gender }}</span></div>
        <div class="info-item"><label>DirecciÃ³n</label><span>{{ user.address }}</span></div>
      </div>

      <!-- EdiciÃ³n -->
      <div class="form-grid" *ngIf="modoEdicion">
        <label class="full">
          <span>Nombre</span>
          <input type="text" [(ngModel)]="user.name" (ngModelChange)="onFieldChange()" placeholder="Tu nombre completo" [class.invalid]="!validation.name">
          <small class="error-text" *ngIf="!validation.name">MÃ­nimo 3 caracteres</small>
        </label>
        <label>
          <span>Fecha de nacimiento</span>
          <input type="date" [(ngModel)]="user.birthDate" (ngModelChange)="onFieldChange()" [class.invalid]="!validation.birthDate">
          <small class="error-text" *ngIf="!validation.birthDate">Fecha invÃ¡lida</small>
        </label>
        <label>
          <span>TelÃ©fono</span>
          <input type="tel" [(ngModel)]="user.phone" (ngModelChange)="onFieldChange()" placeholder="Ej: +51 999 999 999" [class.invalid]="!validation.phone">
          <small class="error-text" *ngIf="!validation.phone">Debe tener al menos 9 dÃ­gitos</small>
        </label>
        <label>
          <span>GÃ©nero</span>
          <select [(ngModel)]="user.gender" (ngModelChange)="onFieldChange()">
            <option>Masculino</option>
            <option>Femenino</option>
            <option>Otro</option>
            <option>Prefiero no decir</option>
          </select>
        </label>
        <label class="full">
          <span>DirecciÃ³n</span>
          <input type="text" [(ngModel)]="user.address" (ngModelChange)="onFieldChange()" placeholder="Calle, nÃºmero, ciudad">
        </label>
      </div>
    </div>

    <!-- BIO -->
    <div class="profile-section card">
      <h3>Sobre mÃ­</h3>
      <p *ngIf="!modoEdicion">{{ user.bio }}</p>
      <textarea *ngIf="modoEdicion" class="bio-textarea" rows="4" [(ngModel)]="user.bio" (ngModelChange)="onFieldChange()" placeholder="Cuenta algo sobre ti..."></textarea>
    </div>

    <!-- INFO PRINCIPAL (tu diseÃ±o original) -->
    <div class="profile-info">

      <div class="info-item">
        <label>Miembro desde</label>
        <span>{{ user.joined }}</span>
      </div>

      <div class="info-item">
        <label>Cursos comprados</label>
        <span>{{ user.courses }}</span>
      </div>

      <div class="info-item">
        <label>Recetas creadas</label>
        <span>{{ user.recipes }}</span>
      </div>

      <div class="info-item">
        <label>Videos vistos</label>
        <span>{{ user.videos }}</span>
      </div>

      <div class="info-item">
        <label>Insignias</label>
        <span>{{ user.badges }}</span>
      </div>

    </div>

    <!-- LOGROS -->
    <div class="profile-section card">
      <h3>Ãšltimos logros</h3>
      <ul>
        <li *ngFor="let a of user.achievements">{{ a }}</li>
      </ul>
    </div>

  </div>

  <!-- Toast sencillo -->
  <div class="toast" *ngIf="toast">{{ toast }}</div>

</div>
