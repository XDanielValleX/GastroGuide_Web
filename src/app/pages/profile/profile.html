<div class="profile-wrapper">

  <div class="background-blobs"></div>

  <div class="profile-card">

    <!-- HEADER -->
    <div class="profile-header">
      <img [src]="user.image" alt="Foto de perfil" id="preview" class="profile-photo">
      <h2>{{ user.name }}</h2>
      <p class="email">{{ user.email }}</p>
      <p class="role">{{ user.role }}</p>

      <!-- Botones de acci√≥n principales -->
      <div class="actions">
        <button class="btn secondary" (click)="irAlInicio()">‚Ü©Ô∏è Ir a inicio</button>
        <button class="btn" (click)="activarEdicion()" *ngIf="!modoEdicion">‚úèÔ∏è Editar datos</button>
        <button class="btn success" *ngIf="modoEdicion" (click)="guardarCambios()" [disabled]="!hasChanges || !isValid">üíæ Guardar</button>
        <button class="btn warning" *ngIf="modoEdicion" (click)="irACambiarPassword()">üîê Cambiar contrase√±a</button>
      </div>

      <!-- Bot√≥n editar foto + input oculto -->
      <button class="edit-btn" *ngIf="modoEdicion" (click)="openSelector()">Editar foto</button>
      <input type="file" hidden id="fileInput" accept="image/*" (change)="changeImage($event)">
    </div>

    <!-- DATOS PERSONALES EDITABLES -->
    <div class="profile-section card">
      <h3>Datos personales</h3>

      <!-- Vista lectura -->
      <div class="readonly" *ngIf="!modoEdicion">
        <div class="info-item"><label>Nombre</label><span>{{ user.name }}</span></div>
        <div class="info-item"><label>Fecha de nacimiento</label><span>{{ user.birthDate | date:'longDate' }}</span></div>
        <div class="info-item"><label>Tel√©fono</label><span>{{ user.phone }}</span></div>
        <div class="info-item"><label>G√©nero</label><span>{{ user.gender }}</span></div>
        <div class="info-item"><label>Direcci√≥n</label><span>{{ user.address }}</span></div>
      </div>

      <!-- Edici√≥n -->
      <div class="form-grid" *ngIf="modoEdicion">
        <label class="full">
          <span>Nombre</span>
          <input type="text" [(ngModel)]="user.name" (ngModelChange)="onFieldChange()" placeholder="Tu nombre completo" [class.invalid]="!validation.name">
          <small class="error-text" *ngIf="!validation.name">M√≠nimo 3 caracteres</small>
        </label>
        <label>
          <span>Fecha de nacimiento</span>
          <input type="date" [(ngModel)]="user.birthDate" (ngModelChange)="onFieldChange()" [class.invalid]="!validation.birthDate">
          <small class="error-text" *ngIf="!validation.birthDate">Fecha inv√°lida</small>
        </label>
        <label>
          <span>Tel√©fono</span>
          <input type="tel" [(ngModel)]="user.phone" (ngModelChange)="onFieldChange()" placeholder="Ej: +51 999 999 999" [class.invalid]="!validation.phone">
          <small class="error-text" *ngIf="!validation.phone">Debe tener al menos 9 d√≠gitos</small>
        </label>
        <label>
          <span>G√©nero</span>
          <select [(ngModel)]="user.gender" (ngModelChange)="onFieldChange()">
            <option>Masculino</option>
            <option>Femenino</option>
            <option>Otro</option>
            <option>Prefiero no decir</option>
          </select>
        </label>
        <label class="full">
          <span>Direcci√≥n</span>
          <input type="text" [(ngModel)]="user.address" (ngModelChange)="onFieldChange()" placeholder="Calle, n√∫mero, ciudad">
        </label>
      </div>
    </div>

    <!-- BIO -->
    <div class="profile-section card">
      <h3>Sobre m√≠</h3>
      <p *ngIf="!modoEdicion">{{ user.bio }}</p>
      <textarea *ngIf="modoEdicion" class="bio-textarea" rows="4" [(ngModel)]="user.bio" (ngModelChange)="onFieldChange()" placeholder="Cuenta algo sobre ti..."></textarea>
    </div>

    <!-- INFO PRINCIPAL (tu dise√±o original) -->
    <div class="profile-info">

      <div class="info-item">
        <label>Miembro desde</label>
        <span>{{ user.joined }}</span>
      </div>

      <div class="info-item">
        <label>Cursos comprados</label>
        <span>{{ user.courses }}</span>
      </div>

      <div class="info-item">
        <label>Recetas creadas</label>
        <span>{{ user.recipes }}</span>
      </div>

      <div class="info-item">
        <label>Videos vistos</label>
        <span>{{ user.videos }}</span>
      </div>

      <div class="info-item">
        <label>Insignias</label>
        <span>{{ user.badges }}</span>
      </div>

    </div>

    <!-- LOGROS -->
    <div class="profile-section card">
      <h3>√öltimos logros</h3>
      <ul>
        <li *ngFor="let a of user.achievements">{{ a }}</li>
      </ul>
    </div>

  </div>

  <!-- Toast sencillo -->
  <div class="toast" *ngIf="toast">{{ toast }}</div>

</div>
